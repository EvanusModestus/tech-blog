<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="description" content="A comprehensive Python framework for managing Cisco ISE at scale, handling everything from bulk operations to automated compliance reporting">
<meta name="keywords" content="ISE, Python, Automation, REST API, Network Security, DevOps">
<meta name="author" content="Evan Rosado">
<title>Automating ISE with Python: Building a Production Management Framework</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<link rel="stylesheet" href="style.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Automating ISE with Python: Building a Production Management Framework</h1>
<div class="details">
<span id="author" class="author">Evan Rosado</span><br>
<span id="email" class="email"><a href="mailto:evan.rosado@outlook.com">evan.rosado@outlook.com</a></span><br>
<span id="revdate">2025-01-20</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_framework_architecture">2. Framework Architecture</a>
<ul class="sectlevel2">
<li><a href="#_core_design_principles">2.1. Core Design Principles</a></li>
<li><a href="#_core_api_client">2.2. Core API Client</a></li>
</ul>
</li>
<li><a href="#_endpoint_management">3. Endpoint Management</a>
<ul class="sectlevel2">
<li><a href="#_bulk_endpoint_operations">3.1. Bulk Endpoint Operations</a></li>
</ul>
</li>
<li><a href="#_policy_management">4. Policy Management</a>
<ul class="sectlevel2">
<li><a href="#_automated_policy_deployment">4.1. Automated Policy Deployment</a></li>
</ul>
</li>
<li><a href="#_operational_automation">5. Operational Automation</a>
<ul class="sectlevel2">
<li><a href="#_zero_downtime_upgrades">5.1. Zero-Downtime Upgrades</a></li>
</ul>
</li>
<li><a href="#_integration_examples">6. Integration Examples</a>
<ul class="sectlevel2">
<li><a href="#_servicenow_integration">6.1. ServiceNow Integration</a></li>
</ul>
</li>
<li><a href="#_production_deployment">7. Production Deployment</a>
<ul class="sectlevel2">
<li><a href="#_daily_operations_script">7.1. Daily Operations Script</a></li>
</ul>
</li>
<li><a href="#_performance_metrics">8. Performance Metrics</a></li>
<li><a href="#_lessons_learned">9. Lessons Learned</a>
<ul class="sectlevel2">
<li><a href="#_what_works">9.1. What Works</a></li>
<li><a href="#_common_pitfalls">9.2. Common Pitfalls</a></li>
</ul>
</li>
<li><a href="#_conclusion">10. Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>After managing ISE deployments with 75,000+ endpoints, manual operations become impossible. This post details the Python automation framework I&#8217;ve built over five years, handling everything from bulk endpoint management to automated compliance reporting and zero-downtime upgrades.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you&#8217;re responsible for ISE infrastructure supporting critical business operations, every minute of downtime costs thousands of dollars. Manual changes introduce risk. Repetitive tasks waste engineering time. After my third all-night maintenance window doing manual endpoint imports, I decided to automate everything.</p>
</div>
<div class="paragraph">
<p>This framework now handles:
* Daily management of 75,000+ endpoints
* Automated policy deployment across 12 ISE nodes
* Compliance reporting for security audits
* Zero-downtime upgrades and patches
* Integration with ServiceNow and Splunk
* Automated backup and disaster recovery</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_framework_architecture">2. Framework Architecture</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_core_design_principles">2.1. Core Design Principles</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="sh">"""</span><span class="s">
ISE Automation Framework Architecture

Principles:
1. Idempotent operations - safe to run multiple times
2. Comprehensive logging - every action is auditable
3. Graceful failure handling - partial success is better than total failure
4. Performance optimization - bulk operations over individual calls
5. Security first - credentials in vault, encryption at rest
</span><span class="sh">"""</span>

<span class="c1"># Framework structure
</span><span class="n">ise_automation</span><span class="o">/</span>
<span class="err">├──</span> <span class="n">core</span><span class="o">/</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">client</span><span class="p">.</span><span class="n">py</span>          <span class="c1"># ISE REST API client
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">auth</span><span class="p">.</span><span class="n">py</span>            <span class="c1"># Authentication handling
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">exceptions</span><span class="p">.</span><span class="n">py</span>      <span class="c1"># Custom exceptions
</span><span class="err">│</span>   <span class="err">└──</span> <span class="n">utils</span><span class="p">.</span><span class="n">py</span>           <span class="c1"># Utility functions
</span><span class="err">├──</span> <span class="n">managers</span><span class="o">/</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">endpoint</span><span class="p">.</span><span class="n">py</span>        <span class="c1"># Endpoint management
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">policy</span><span class="p">.</span><span class="n">py</span>          <span class="c1"># Policy management
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">identity</span><span class="p">.</span><span class="n">py</span>        <span class="c1"># Identity group management
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">device</span><span class="p">.</span><span class="n">py</span>          <span class="c1"># Network device management
</span><span class="err">│</span>   <span class="err">└──</span> <span class="n">guest</span><span class="p">.</span><span class="n">py</span>           <span class="c1"># Guest portal management
</span><span class="err">├──</span> <span class="n">operations</span><span class="o">/</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">backup</span><span class="p">.</span><span class="n">py</span>          <span class="c1"># Backup operations
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">upgrade</span><span class="p">.</span><span class="n">py</span>         <span class="c1"># Upgrade automation
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">compliance</span><span class="p">.</span><span class="n">py</span>      <span class="c1"># Compliance checks
</span><span class="err">│</span>   <span class="err">└──</span> <span class="n">reporting</span><span class="p">.</span><span class="n">py</span>       <span class="c1"># Report generation
</span><span class="err">├──</span> <span class="n">integrations</span><span class="o">/</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">servicenow</span><span class="p">.</span><span class="n">py</span>      <span class="c1"># ServiceNow integration
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">splunk</span><span class="p">.</span><span class="n">py</span>          <span class="c1"># Splunk integration
</span><span class="err">│</span>   <span class="err">├──</span> <span class="n">vault</span><span class="p">.</span><span class="n">py</span>           <span class="c1"># HashiCorp Vault
</span><span class="err">│</span>   <span class="err">└──</span> <span class="n">teams</span><span class="p">.</span><span class="n">py</span>           <span class="c1"># Microsoft Teams notifications
</span><span class="err">└──</span> <span class="n">scripts</span><span class="o">/</span>
    <span class="err">├──</span> <span class="n">daily_tasks</span><span class="p">.</span><span class="n">py</span>     <span class="c1"># Daily automation
</span>    <span class="err">├──</span> <span class="n">emergency</span><span class="p">.</span><span class="n">py</span>       <span class="c1"># Emergency procedures
</span>    <span class="err">└──</span> <span class="n">migration</span><span class="p">.</span><span class="n">py</span>       <span class="c1"># Migration tools</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_core_api_client">2.2. Core API Client</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1"># core/client.py - Production-tested ISE API client
</span><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">from</span> <span class="n">urllib3.util.retry</span> <span class="kn">import</span> <span class="n">Retry</span>
<span class="kn">from</span> <span class="n">requests.adapters</span> <span class="kn">import</span> <span class="n">HTTPAdapter</span>
<span class="kn">import</span> <span class="n">concurrent.futures</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ISENode</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">ISE node configuration</span><span class="sh">"""</span>
    <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ip</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># PAN, MNT, PSN, pxGrid
</span>    <span class="n">region</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">RateLimiter</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Rate limiter to prevent API throttling</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">calls_per_second</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">calls_per_second</span> <span class="o">=</span> <span class="n">calls_per_second</span>
        <span class="n">self</span><span class="p">.</span><span class="n">min_interval</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">calls_per_second</span>
        <span class="n">self</span><span class="p">.</span><span class="n">last_call</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Wait if necessary to maintain rate limit</span><span class="sh">"""</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">last_call</span>
        <span class="k">if</span> <span class="n">elapsed</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">min_interval</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">min_interval</span> <span class="o">-</span> <span class="n">elapsed</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">last_call</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">retry_on_failure</span><span class="p">(</span><span class="n">max_retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">backoff_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Decorator for automatic retry with exponential backoff</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">last_exception</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">last_exception</span> <span class="o">=</span> <span class="n">e</span>
                    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">backoff_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="n">attempt</span><span class="p">)</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Attempt </span><span class="si">{</span><span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">. </span><span class="sh">"</span>
                                 <span class="sa">f</span><span class="sh">"</span><span class="s">Retrying in </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s">s...</span><span class="sh">"</span><span class="p">)</span>
                    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">last_exception</span>
        <span class="k">return</span> <span class="n">wrapper</span>
    <span class="k">return</span> <span class="n">decorator</span>

<span class="k">class</span> <span class="nc">ISEClient</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Production ISE REST API Client</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ISENode</span><span class="p">],</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">verify_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="n">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="n">self</span><span class="p">.</span><span class="n">verify_ssl</span> <span class="o">=</span> <span class="n">verify_ssl</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="nc">RateLimiter</span><span class="p">(</span><span class="n">calls_per_second</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="c1"># Session with retry strategy
</span>        <span class="n">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_create_session</span><span class="p">()</span>

        <span class="c1"># Find active PAN
</span>        <span class="n">self</span><span class="p">.</span><span class="n">pan_node</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_active_pan</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">https://</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">pan_node</span><span class="p">.</span><span class="n">ip</span><span class="si">}</span><span class="s">:9060/ers</span><span class="sh">"</span>

        <span class="c1"># Headers for all requests
</span>        <span class="n">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">Accept</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_create_session</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Create session with retry strategy</span><span class="sh">"""</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
        <span class="n">session</span><span class="p">.</span><span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
        <span class="n">session</span><span class="p">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">verify_ssl</span>

        <span class="c1"># Retry strategy
</span>        <span class="n">retry_strategy</span> <span class="o">=</span> <span class="nc">Retry</span><span class="p">(</span>
            <span class="n">total</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">backoff_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">status_forcelist</span><span class="o">=</span><span class="p">[</span><span class="mi">429</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">adapter</span> <span class="o">=</span> <span class="nc">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="n">retry_strategy</span><span class="p">)</span>
        <span class="n">session</span><span class="p">.</span><span class="nf">mount</span><span class="p">(</span><span class="sh">"</span><span class="s">https://</span><span class="sh">"</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">session</span>

    <span class="k">def</span> <span class="nf">_get_active_pan</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ISENode</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Find active PAN node</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PAN</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">active</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Test connectivity
</span>                    <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
                        <span class="sa">f</span><span class="sh">"</span><span class="s">https://</span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">ip</span><span class="si">}</span><span class="s">:9060/ers/config/node</span><span class="sh">"</span><span class="p">,</span>
                        <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Active PAN found: </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">node</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Node </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s"> not responding: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">No active PAN node found</span><span class="sh">"</span><span class="p">)</span>

    <span class="nd">@retry_on_failure</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">GET request with retry logic</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span><span class="p">.</span><span class="nf">wait</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">GET </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s"> failed: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>

    <span class="nd">@retry_on_failure</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">POST request with retry logic</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span><span class="p">.</span><span class="nf">wait</span><span class="p">()</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">]:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">POST </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s"> failed: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span> <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">bulk_operation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
                      <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Execute bulk operations with batching</span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Process in batches
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">items</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing batch </span><span class="si">{</span><span class="n">i</span> <span class="o">//</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> </span><span class="sh">"</span>
                       <span class="sa">f</span><span class="sh">"</span><span class="s">(</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span><span class="si">}</span><span class="s"> items)</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Parallel processing within batch
</span>            <span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">executor</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span> <span class="n">item</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">batch</span>
                <span class="p">}</span>

                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="nf">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="nf">result</span><span class="p">()</span>
                        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
                    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to process </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">item</span><span class="sh">"</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">health_check</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Check health of all ISE nodes</span><span class="sh">"""</span>
        <span class="n">health_status</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
                    <span class="sa">f</span><span class="sh">"</span><span class="s">https://</span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">ip</span><span class="si">}</span><span class="s">:9060/ers/config/node</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span>
                <span class="p">)</span>
                <span class="n">health_status</span><span class="p">[</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">healthy</span><span class="sh">"</span> <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="sh">"</span><span class="s">unhealthy</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">response_time</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">elapsed</span><span class="p">.</span><span class="nf">total_seconds</span><span class="p">(),</span>
                    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="n">node</span><span class="p">.</span><span class="n">role</span>
                <span class="p">}</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">health_status</span><span class="p">[</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">unreachable</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                    <span class="sh">"</span><span class="s">role</span><span class="sh">"</span><span class="p">:</span> <span class="n">node</span><span class="p">.</span><span class="n">role</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="n">health_status</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_endpoint_management">3. Endpoint Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_bulk_endpoint_operations">3.1. Bulk Endpoint Operations</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1"># managers/endpoint.py - Endpoint management at scale
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">hashlib</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">class</span> <span class="nc">EndpointManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Manage ISE endpoints at scale</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">ISEClient</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache_ttl</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes
</span>
    <span class="k">def</span> <span class="nf">import_from_csv</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">validate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Import endpoints from CSV file</span><span class="sh">"""</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

        <span class="c1"># Validate data
</span>        <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_validate_endpoints</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="c1"># Convert to ISE format
</span>        <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="nf">iterrows</span><span class="p">():</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">].</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">upper</span><span class="p">(),</span>
                    <span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_normalize_mac</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">]),</span>
                    <span class="sh">"</span><span class="s">groupId</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_group_id</span><span class="p">(</span><span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">group</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">)),</span>
                    <span class="sh">"</span><span class="s">staticGroupAssignment</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="sh">"</span><span class="s">Owner</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">owner</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">),</span>
                            <span class="sh">"</span><span class="s">Department</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">department</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">IT</span><span class="sh">'</span><span class="p">),</span>
                            <span class="sh">"</span><span class="s">AssetTag</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">asset_tag</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">),</span>
                            <span class="sh">"</span><span class="s">Location</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">),</span>
                            <span class="sh">"</span><span class="s">DeviceType</span><span class="sh">"</span><span class="p">:</span> <span class="n">row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">device_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1"># Add profile if specified
</span>            <span class="k">if</span> <span class="sh">'</span><span class="s">profile</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">row</span> <span class="ow">and</span> <span class="n">pd</span><span class="p">.</span><span class="nf">notna</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">profile</span><span class="sh">'</span><span class="p">]):</span>
                <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">profileId</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_profile_id</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="sh">'</span><span class="s">profile</span><span class="sh">'</span><span class="p">])</span>

            <span class="n">endpoints</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="c1"># Bulk import
</span>        <span class="n">results</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bulk_create</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)</span>

        <span class="c1"># Generate report
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_generate_import_report</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">csv_file</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_validate_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Validate endpoint data</span><span class="sh">"""</span>
        <span class="c1"># Remove duplicates
</span>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">])</span>

        <span class="c1"># Validate MAC addresses
</span>        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_valid</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_is_valid_mac</span><span class="p">)</span>
        <span class="n">invalid_macs</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_valid</span><span class="sh">'</span><span class="p">]]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">invalid_macs</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">invalid_macs</span><span class="p">)</span><span class="si">}</span><span class="s"> invalid MAC addresses</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_valid</span><span class="sh">'</span><span class="p">]]</span>

        <span class="c1"># Normalize MAC addresses
</span>        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">mac_address</span><span class="sh">'</span><span class="p">].</span><span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_normalize_mac</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_normalize_mac</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Normalize MAC address format</span><span class="sh">"""</span>
        <span class="c1"># Remove all separators
</span>        <span class="n">mac</span> <span class="o">=</span> <span class="n">mac</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">upper</span><span class="p">()</span>

        <span class="c1"># Insert colons every 2 characters
</span>        <span class="k">return</span> <span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">mac</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_is_valid_mac</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Validate MAC address format</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">re</span>
        <span class="c1"># Accept various formats
</span>        <span class="n">patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">r</span><span class="sh">'</span><span class="s">^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># AA:BB:CC:DD:EE:FF
</span>            <span class="sa">r</span><span class="sh">'</span><span class="s">^([0-9A-Fa-f]{4}\.){2}([0-9A-Fa-f]{4})$</span><span class="sh">'</span><span class="p">,</span>     <span class="c1"># AABB.CCDD.EEFF
</span>            <span class="sa">r</span><span class="sh">'</span><span class="s">^[0-9A-Fa-f]{12}$</span><span class="sh">'</span>                             <span class="c1"># AABBCCDDEEFF
</span>        <span class="p">]</span>
        <span class="k">return</span> <span class="nf">any</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">mac</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bulk_create</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Bulk create endpoints</span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">created</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">updated</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="n">endpoints</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">]</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing batch </span><span class="si">{</span><span class="n">i</span> <span class="o">//</span> <span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Check if exists
</span>                    <span class="n">mac</span> <span class="o">=</span> <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">]</span>
                    <span class="n">existing</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_endpoint_by_mac</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">existing</span><span class="p">:</span>
                        <span class="c1"># Update existing
</span>                        <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">existing</span><span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span>
                        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span>
                            <span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint/</span><span class="si">{</span><span class="n">existing</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
                            <span class="n">endpoint</span>
                        <span class="p">)</span>
                        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">updated</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Create new
</span>                        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">config/endpoint</span><span class="sh">"</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>
                        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">created</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>

                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to process </span><span class="si">{</span><span class="n">mac</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">:</span> <span class="n">mac</span><span class="p">,</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_get_endpoint_by_mac</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Get endpoint by MAC address</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint?filter=mac.EQ.</span><span class="si">{</span><span class="n">mac</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">SearchResult</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">endpoint_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="sh">"</span><span class="s">SearchResult</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">resources</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint/</span><span class="si">{</span><span class="n">endpoint_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">quarantine_endpoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">mac</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">Security violation</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Move endpoint to quarantine group</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_endpoint_by_mac</span><span class="p">(</span><span class="n">mac</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Endpoint </span><span class="si">{</span><span class="n">mac</span><span class="si">}</span><span class="s"> not found</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="c1"># Update to quarantine group
</span>            <span class="n">quarantine_group_id</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_group_id</span><span class="p">(</span><span class="sh">"</span><span class="s">Quarantine</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">groupId</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">quarantine_group_id</span>
            <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">QuarantineReason</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">reason</span>
            <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">QuarantineTime</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">()</span>

            <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint/</span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="p">{</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">})</span>

            <span class="c1"># Send notification
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">_send_quarantine_notification</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>

            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Endpoint </span><span class="si">{</span><span class="n">mac</span><span class="si">}</span><span class="s"> quarantined: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to quarantine </span><span class="si">{</span><span class="n">mac</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">bulk_delete_stale</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">days_inactive</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">90</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Delete endpoints not seen for specified days</span><span class="sh">"""</span>
        <span class="n">cutoff_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_inactive</span><span class="p">)</span>

        <span class="c1"># Get all endpoints
</span>        <span class="n">all_endpoints</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_all_endpoints</span><span class="p">()</span>

        <span class="n">stale_endpoints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">all_endpoints</span><span class="p">:</span>
            <span class="c1"># Check last authentication time
</span>            <span class="n">last_auth</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_last_authentication</span><span class="p">(</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">last_auth</span> <span class="ow">and</span> <span class="n">last_auth</span> <span class="o">&lt;</span> <span class="n">cutoff_date</span><span class="p">:</span>
                <span class="n">stale_endpoints</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stale_endpoints</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">stale_endpoints</span><span class="p">)</span><span class="si">}</span><span class="s"> stale endpoints</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Confirm before deletion
</span>            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_confirm_bulk_delete</span><span class="p">(</span><span class="n">stale_endpoints</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_bulk_delete</span><span class="p">(</span><span class="n">stale_endpoints</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">deleted</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">_bulk_delete</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Bulk delete endpoints</span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">deleted</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span> <span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">endpoints</span><span class="p">)}</span>

        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">endpoints</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint/</span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">deleted</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to delete </span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">'</span><span class="s">mac</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)})</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">generate_compliance_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Generate endpoint compliance report</span><span class="sh">"""</span>
        <span class="n">all_endpoints</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_all_endpoints</span><span class="p">()</span>

        <span class="n">report_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="n">all_endpoints</span><span class="p">:</span>
            <span class="c1"># Get endpoint details
</span>            <span class="n">details</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">config/endpoint/</span><span class="si">{</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)[</span><span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">]</span>

            <span class="c1"># Get authentication history
</span>            <span class="n">auth_history</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_authentication_history</span><span class="p">(</span><span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">])</span>

            <span class="c1"># Determine compliance status
</span>            <span class="n">compliance_status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_compliance</span><span class="p">(</span><span class="n">details</span><span class="p">,</span> <span class="n">auth_history</span><span class="p">)</span>

            <span class="n">report_data</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">MAC Address</span><span class="sh">"</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">[</span><span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span> <span class="n">details</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">Group</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_group_name</span><span class="p">(</span><span class="n">details</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">groupId</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
                <span class="sh">"</span><span class="s">Profile</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_profile_name</span><span class="p">(</span><span class="n">details</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">profileId</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">)),</span>
                <span class="sh">"</span><span class="s">Owner</span><span class="sh">"</span><span class="p">:</span> <span class="n">details</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">Owner</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unknown</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">Department</span><span class="sh">"</span><span class="p">:</span> <span class="n">details</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">Department</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unknown</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">Last Seen</span><span class="sh">"</span><span class="p">:</span> <span class="n">auth_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">auth_history</span> <span class="k">else</span> <span class="sh">"</span><span class="s">Never</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">Auth Success Rate</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_auth_success_rate</span><span class="p">(</span><span class="n">auth_history</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">Compliance Status</span><span class="sh">"</span><span class="p">:</span> <span class="n">compliance_status</span><span class="p">[</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">Compliance Issues</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">compliance_status</span><span class="p">[</span><span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">])</span>
            <span class="p">})</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="n">df</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Compliance report saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">_check_compliance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">auth_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Check endpoint compliance</span><span class="sh">"""</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check if profiled
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">profileId</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Not profiled</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check if grouped properly
</span>        <span class="k">if</span> <span class="n">endpoint</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">groupId</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_group_id</span><span class="p">(</span><span class="sh">"</span><span class="s">Unknown</span><span class="sh">"</span><span class="p">):</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Unknown group</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check authentication frequency
</span>        <span class="k">if</span> <span class="n">auth_history</span><span class="p">:</span>
            <span class="n">last_auth</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromisoformat</span><span class="p">(</span><span class="n">auth_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">])</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_auth</span><span class="p">).</span><span class="n">days</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Inactive &gt; 30 days</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Check for authentication failures
</span>            <span class="n">failures</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">auth_history</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]]</span>
            <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">failures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">auth_history</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">:</span>  <span class="c1"># More than 10% failures
</span>                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">High auth failure rate</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Never authenticated</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Non-Compliant</span><span class="sh">"</span> <span class="k">if</span> <span class="n">issues</span> <span class="k">else</span> <span class="sh">"</span><span class="s">Compliant</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">:</span> <span class="n">issues</span>
        <span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_management">4. Policy Management</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_automated_policy_deployment">4.1. Automated Policy Deployment</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1"># managers/policy.py - Policy automation
</span><span class="kn">import</span> <span class="n">yaml</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span> <span class="n">difflib</span>

<span class="k">class</span> <span class="nc">PolicyManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Manage ISE policies with version control</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">ISEClient</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">policy_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">export_policies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">yaml</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Export all policies for backup/version control</span><span class="sh">"""</span>
        <span class="n">policies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">authentication</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_export_auth_policies</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_export_authz_policies</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">profiling</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_export_profiling_policies</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">posture</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_export_posture_policies</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">guest</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_export_guest_policies</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="sh">"</span><span class="s">yaml</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">yaml</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">policies</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Policies exported to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">import_policies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Import policies from file with validation</span><span class="sh">"""</span>
        <span class="c1"># Load policies
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">input_file</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.yaml</span><span class="sh">'</span><span class="p">):</span>
                <span class="n">policies</span> <span class="o">=</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">policies</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1"># Validate structure
</span>        <span class="n">validation_results</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_validate_policy_structure</span><span class="p">(</span><span class="n">policies</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation_results</span><span class="p">[</span><span class="sh">"</span><span class="s">valid</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Policy validation failed: </span><span class="si">{</span><span class="n">validation_results</span><span class="p">[</span><span class="sh">'</span><span class="s">errors</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">validation_results</span>

        <span class="c1"># Compare with existing
</span>        <span class="n">changes</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compare_policies</span><span class="p">(</span><span class="n">policies</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Dry run mode - no changes applied</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">changes</span><span class="sh">"</span><span class="p">:</span> <span class="n">changes</span><span class="p">,</span> <span class="sh">"</span><span class="s">applied</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>

        <span class="c1"># Apply changes
</span>        <span class="n">results</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_apply_policy_changes</span><span class="p">(</span><span class="n">changes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_compare_policies</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_policies</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Compare new policies with existing</span><span class="sh">"""</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">create</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">delete</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">unchanged</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="n">existing</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">export_policies</span><span class="p">(</span><span class="sh">"</span><span class="s">/tmp/current_policies.yaml</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Deep comparison
</span>        <span class="k">for</span> <span class="n">policy_type</span><span class="p">,</span> <span class="n">policies</span> <span class="ow">in</span> <span class="n">new_policies</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">existing_type</span> <span class="o">=</span> <span class="n">existing</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">policy_type</span><span class="p">,</span> <span class="p">{})</span>

            <span class="k">for</span> <span class="n">policy_name</span><span class="p">,</span> <span class="n">policy_config</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">policy_name</span> <span class="ow">in</span> <span class="n">existing_type</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">policy_config</span> <span class="o">!=</span> <span class="n">existing_type</span><span class="p">[</span><span class="n">policy_name</span><span class="p">]:</span>
                        <span class="n">changes</span><span class="p">[</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                            <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_type</span><span class="p">,</span>
                            <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_name</span><span class="p">,</span>
                            <span class="sh">"</span><span class="s">diff</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_diff</span><span class="p">(</span>
                                <span class="n">existing_type</span><span class="p">[</span><span class="n">policy_name</span><span class="p">],</span>
                                <span class="n">policy_config</span>
                            <span class="p">)</span>
                        <span class="p">})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">changes</span><span class="p">[</span><span class="sh">"</span><span class="s">unchanged</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                            <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_type</span><span class="p">,</span>
                            <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_name</span>
                        <span class="p">})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">changes</span><span class="p">[</span><span class="sh">"</span><span class="s">create</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_type</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_name</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">config</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_config</span>
                    <span class="p">})</span>

            <span class="c1"># Check for deletions
</span>            <span class="k">for</span> <span class="n">policy_name</span> <span class="ow">in</span> <span class="n">existing_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">policy_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">policies</span><span class="p">:</span>
                    <span class="n">changes</span><span class="p">[</span><span class="sh">"</span><span class="s">delete</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_type</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">policy_name</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">changes</span>

    <span class="k">def</span> <span class="nf">_generate_diff</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">old</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">new</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Generate human-readable diff</span><span class="sh">"""</span>
        <span class="n">old_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">new_str</span> <span class="o">=</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="p">.</span><span class="nf">unified_diff</span><span class="p">(</span>
            <span class="n">old_str</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">new_str</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">(</span><span class="n">keepends</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">fromfile</span><span class="o">=</span><span class="sh">"</span><span class="s">current</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">tofile</span><span class="o">=</span><span class="sh">"</span><span class="s">new</span><span class="sh">"</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="sh">''</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_authorization_rule</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
                                 <span class="n">profile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Create authorization rule with validation</span><span class="sh">"""</span>
        <span class="c1"># Build rule
</span>        <span class="n">rule</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">rule</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">enabled</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_build_condition</span><span class="p">(</span><span class="n">conditions</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">profile</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">profile</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Validate rule
</span>        <span class="n">validation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_validate_authorization_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validation</span><span class="p">[</span><span class="sh">"</span><span class="s">valid</span><span class="sh">"</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Invalid rule: </span><span class="si">{</span><span class="n">validation</span><span class="p">[</span><span class="sh">'</span><span class="s">errors</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Create rule
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">config/authorizationprofile/authorizationrule</span><span class="sh">"</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>

        <span class="c1"># Position rule if specified
</span>        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_reorder_rules</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Authorization rule </span><span class="sh">'</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="sh">'</span><span class="s"> created</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">_build_condition</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">conditions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Build ISE condition from simplified format</span><span class="sh">"""</span>
        <span class="c1"># Handle simple conditions
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">attribute</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">conditionType</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ConditionAttributes</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">isNegate</span><span class="sh">"</span><span class="p">:</span> <span class="n">conditions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">negate</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">dictionaryName</span><span class="sh">"</span><span class="p">:</span> <span class="n">conditions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">dictionary</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">DEVICE</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">attributeName</span><span class="sh">"</span><span class="p">:</span> <span class="n">conditions</span><span class="p">[</span><span class="sh">"</span><span class="s">attribute</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">operator</span><span class="sh">"</span><span class="p">:</span> <span class="n">conditions</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">operator</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">equals</span><span class="sh">"</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">attributeValue</span><span class="sh">"</span><span class="p">:</span> <span class="n">conditions</span><span class="p">[</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Handle compound conditions
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">and</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">conditionType</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ConditionAndBlock</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">_build_condition</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">[</span><span class="sh">"</span><span class="s">and</span><span class="sh">"</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="sh">"</span><span class="s">or</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">conditionType</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ConditionOrBlock</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">children</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">_build_condition</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">conditions</span><span class="p">[</span><span class="sh">"</span><span class="s">or</span><span class="sh">"</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">}</span>

        <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Invalid condition format: </span><span class="si">{</span><span class="n">conditions</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deploy_policy_set</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">policy_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">production</span><span class="sh">"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Deploy complete policy set with rollback capability</span><span class="sh">"""</span>
        <span class="c1"># Create backup
</span>        <span class="n">backup_file</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">/tmp/policy_backup_</span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y%m%d_%H%M%S</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">.yaml</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">export_policies</span><span class="p">(</span><span class="n">backup_file</span><span class="p">)</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Backup created: </span><span class="si">{</span><span class="n">backup_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Load and validate policy set
</span>            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">policy_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">policy_set</span> <span class="o">=</span> <span class="n">yaml</span><span class="p">.</span><span class="nf">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Environment-specific adjustments
</span>            <span class="k">if</span> <span class="n">environment</span> <span class="o">==</span> <span class="sh">"</span><span class="s">staging</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">policy_set</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_adjust_for_staging</span><span class="p">(</span><span class="n">policy_set</span><span class="p">)</span>

            <span class="c1"># Deploy in phases
</span>            <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">phase1_auth</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_deploy_auth_policies</span><span class="p">(</span><span class="n">policy_set</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">authentication</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="sh">"</span><span class="s">phase2_authz</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_deploy_authz_policies</span><span class="p">(</span><span class="n">policy_set</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">authorization</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="sh">"</span><span class="s">phase3_profiling</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_deploy_profiling_policies</span><span class="p">(</span><span class="n">policy_set</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">profiling</span><span class="sh">"</span><span class="p">,</span> <span class="p">{})),</span>
                <span class="sh">"</span><span class="s">phase4_posture</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_deploy_posture_policies</span><span class="p">(</span><span class="n">policy_set</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">posture</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}))</span>
            <span class="p">}</span>

            <span class="c1"># Verify deployment
</span>            <span class="n">verification</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_verify_deployment</span><span class="p">(</span><span class="n">policy_set</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">verification</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sh">"</span><span class="s">Deployment verification failed, rolling back</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">rollback</span><span class="p">(</span><span class="n">backup_file</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">rollback</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">errors</span><span class="sh">"</span><span class="p">:</span> <span class="n">verification</span><span class="p">[</span><span class="sh">"</span><span class="s">errors</span><span class="sh">"</span><span class="p">]}</span>

            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Policy deployment successful</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">results</span><span class="sh">"</span><span class="p">:</span> <span class="n">results</span><span class="p">}</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Policy deployment failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">rollback</span><span class="p">(</span><span class="n">backup_file</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">rollback</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">rollback</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">backup_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Rollback to previous policy configuration</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rolling back to </span><span class="si">{</span><span class="n">backup_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">import_policies</span><span class="p">(</span><span class="n">backup_file</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Rollback successful</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rollback failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operational_automation">5. Operational Automation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zero_downtime_upgrades">5.1. Zero-Downtime Upgrades</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1"># operations/upgrade.py - Automated ISE upgrades
</span><span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">UpgradeManager</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Manage ISE upgrades with zero downtime</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">ISEClient</span><span class="p">,</span> <span class="n">nodes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ISENode</span><span class="p">]):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="n">self</span><span class="p">.</span><span class="n">upgrade_log</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">plan_upgrade</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">target_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Plan upgrade sequence for zero downtime</span><span class="sh">"""</span>
        <span class="n">current_versions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_node_versions</span><span class="p">()</span>

        <span class="c1"># Determine upgrade order
</span>        <span class="n">upgrade_plan</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">target_version</span><span class="sh">"</span><span class="p">:</span> <span class="n">target_version</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Phase 1: Secondary nodes
</span>        <span class="n">phase1</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Secondary Admin Nodes</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PAN</span><span class="sh">"</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">n</span><span class="p">.</span><span class="n">active</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Phase 2: PSN nodes (rolling upgrade)
</span>        <span class="n">psn_nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PSN</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">psn_groups</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_group_psns_by_region</span><span class="p">(</span><span class="n">psn_nodes</span><span class="p">)</span>

        <span class="n">phase2</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Policy Service Nodes (Rolling)</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">groups</span><span class="sh">"</span><span class="p">:</span> <span class="n">psn_groups</span>
        <span class="p">}</span>

        <span class="c1"># Phase 3: MnT nodes
</span>        <span class="n">phase3</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Monitoring Nodes</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">MNT</span><span class="sh">"</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Phase 4: Primary PAN
</span>        <span class="n">phase4</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Primary Admin Node</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PAN</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">n</span><span class="p">.</span><span class="n">active</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">upgrade_plan</span><span class="p">[</span><span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">phase1</span><span class="p">,</span> <span class="n">phase2</span><span class="p">,</span> <span class="n">phase3</span><span class="p">,</span> <span class="n">phase4</span><span class="p">]</span>

        <span class="c1"># Validate plan
</span>        <span class="n">validation</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_validate_upgrade_plan</span><span class="p">(</span><span class="n">upgrade_plan</span><span class="p">)</span>
        <span class="n">upgrade_plan</span><span class="p">[</span><span class="sh">"</span><span class="s">validation</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation</span>

        <span class="k">return</span> <span class="n">upgrade_plan</span>

    <span class="k">def</span> <span class="nf">execute_upgrade</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">plan</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">auto_confirm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Execute upgrade plan</span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">[</span><span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">phase_result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">description</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># PSN rolling upgrade
</span>                <span class="n">phase_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_execute_psn_rolling_upgrade</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">groups</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">phase</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">node_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_upgrade_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">plan</span><span class="p">[</span><span class="sh">"</span><span class="s">target_version</span><span class="sh">"</span><span class="p">])</span>
                    <span class="n">phase_result</span><span class="p">[</span><span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">node_result</span><span class="p">)</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node_result</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]:</span>
                        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">auto_confirm</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="nf">_confirm_continue</span><span class="p">():</span>
                                <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sh">"</span><span class="s">Upgrade aborted by user</span><span class="sh">"</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">results</span>

            <span class="n">phase_result</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
            <span class="n">phase_result</span><span class="p">[</span><span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">phase_result</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">phase_result</span><span class="p">[</span><span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">).</span><span class="nf">total_seconds</span><span class="p">()</span>

            <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">phase_result</span><span class="p">)</span>

            <span class="c1"># Wait between phases
</span>            <span class="k">if</span> <span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">phase</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Waiting 10 minutes before next phase...</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">600</span><span class="p">)</span>

        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">total_duration</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">]</span>
        <span class="p">).</span><span class="nf">total_seconds</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_execute_psn_rolling_upgrade</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">psn_groups</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">ISENode</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Execute rolling PSN upgrade maintaining service</span><span class="sh">"""</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">groups</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">group_idx</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">psn_groups</span><span class="p">):</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Upgrading PSN group </span><span class="si">{</span><span class="n">group_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">psn_groups</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Remove group from load balancer
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">_remove_from_lb</span><span class="p">([</span><span class="n">n</span><span class="p">.</span><span class="n">ip</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">group</span><span class="p">])</span>

            <span class="c1"># Upgrade nodes in parallel
</span>            <span class="n">group_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">with</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
                <span class="n">futures</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">executor</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">_upgrade_node</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> <span class="n">node</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span>
                <span class="p">}</span>

                <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">concurrent</span><span class="p">.</span><span class="n">futures</span><span class="p">.</span><span class="nf">as_completed</span><span class="p">(</span><span class="n">futures</span><span class="p">):</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">futures</span><span class="p">[</span><span class="n">future</span><span class="p">]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="p">.</span><span class="nf">result</span><span class="p">()</span>
                    <span class="n">group_results</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="c1"># Verify upgraded nodes
</span>            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_verify_node_health</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="c1"># Add back to load balancer
</span>                    <span class="n">self</span><span class="p">.</span><span class="nf">_add_to_lb</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">ip</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Node </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s"> failed health check after upgrade</span><span class="sh">"</span><span class="p">)</span>

            <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">groups</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">group</span><span class="sh">"</span><span class="p">:</span> <span class="n">group_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">:</span> <span class="n">group_results</span>
            <span class="p">})</span>

            <span class="c1"># Wait before next group
</span>            <span class="k">if</span> <span class="n">group_idx</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">psn_groups</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Waiting 5 minutes before next group...</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_upgrade_node</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ISENode</span><span class="p">,</span> <span class="n">target_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Upgrade individual node</span><span class="sh">"""</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">node</span><span class="sh">"</span><span class="p">:</span> <span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Starting upgrade of </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">target_version</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Pre-upgrade checks
</span>            <span class="n">pre_checks</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_pre_upgrade_checks</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_checks</span><span class="p">[</span><span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">]:</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Pre-upgrade checks failed: </span><span class="si">{</span><span class="n">pre_checks</span><span class="p">[</span><span class="sh">'</span><span class="s">issues</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>
                <span class="k">return</span> <span class="n">result</span>

            <span class="c1"># Trigger upgrade
</span>            <span class="n">upgrade_response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_trigger_upgrade</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_version</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">upgrade_id</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">upgrade_response</span><span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span>

            <span class="c1"># Monitor upgrade progress
</span>            <span class="n">upgrade_status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_monitor_upgrade</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">upgrade_response</span><span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">])</span>
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">upgrade_status</span><span class="p">[</span><span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">upgrade_status</span><span class="p">[</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">completed</span><span class="sh">"</span><span class="p">:</span>
                <span class="c1"># Post-upgrade verification
</span>                <span class="n">post_checks</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_post_upgrade_checks</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">target_version</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">post_checks</span><span class="p">[</span><span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">]:</span>
                    <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Node </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s"> upgraded successfully</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Post-upgrade checks failed: </span><span class="si">{</span><span class="n">post_checks</span><span class="p">[</span><span class="sh">'</span><span class="s">issues</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Upgrade failed: </span><span class="si">{</span><span class="n">upgrade_status</span><span class="p">[</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Upgrade failed for </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_pre_upgrade_checks</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ISENode</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Pre-upgrade validation</span><span class="sh">"""</span>
        <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Check disk space
</span>        <span class="n">disk_space</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_disk_space</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">disk_space</span><span class="p">[</span><span class="sh">"</span><span class="s">available_gb</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Insufficient disk space: </span><span class="si">{</span><span class="n">disk_space</span><span class="p">[</span><span class="sh">'</span><span class="s">available_gb</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">GB</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check replication status
</span>        <span class="n">replication</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_replication_status</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replication</span><span class="p">[</span><span class="sh">"</span><span class="s">in_sync</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Replication not in sync</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check for active sessions
</span>        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PSN</span><span class="sh">"</span><span class="p">:</span>
            <span class="n">active_sessions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_active_sessions</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">active_sessions</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="n">logger</span><span class="p">.</span><span class="nf">warning</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">High active sessions on </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="n">hostname</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">active_sessions</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Backup configuration
</span>        <span class="n">backup_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_backup_node_config</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">backup_result</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">passed</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">checks</span><span class="p">[</span><span class="sh">"</span><span class="s">issues</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">Backup failed</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">checks</span>

    <span class="k">def</span> <span class="nf">generate_upgrade_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Generate detailed upgrade report</span><span class="sh">"""</span>
        <span class="n">report</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">ISE UPGRADE REPORT</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Start Time: </span><span class="si">{</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">start_time</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">End Time: </span><span class="si">{</span><span class="n">results</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">end_time</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">In Progress</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Total Duration: </span><span class="si">{</span><span class="n">results</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">total_duration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3600</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> hours</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Overall Status: </span><span class="si">{</span><span class="sh">'</span><span class="s">SUCCESS</span><span class="sh">'</span> <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">'</span><span class="s">FAILED</span><span class="sh">'</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">phases</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Phase </span><span class="si">{</span><span class="n">phase</span><span class="p">[</span><span class="sh">'</span><span class="s">phase</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">phase</span><span class="p">[</span><span class="sh">'</span><span class="s">description</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">-</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

            <span class="k">if</span> <span class="sh">"</span><span class="s">groups</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">phase</span><span class="p">:</span>  <span class="c1"># PSN rolling upgrade
</span>                <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">phase</span><span class="p">[</span><span class="sh">"</span><span class="s">groups</span><span class="sh">"</span><span class="p">]:</span>
                    <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Group </span><span class="si">{</span><span class="n">group</span><span class="p">[</span><span class="sh">'</span><span class="s">group</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">]:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">✓</span><span class="sh">"</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">✗</span><span class="sh">"</span>
                        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="sh">'</span><span class="s">node</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]:</span>
                            <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">      Error: </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">phase</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">nodes</span><span class="sh">"</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="sh">"</span><span class="s">✓</span><span class="sh">"</span> <span class="k">if</span> <span class="n">node</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">✗</span><span class="sh">"</span>
                    <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">node</span><span class="p">[</span><span class="sh">'</span><span class="s">node</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">[</span><span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">]:</span>
                        <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    Error: </span><span class="si">{</span><span class="n">node</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

            <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Duration: </span><span class="si">{</span><span class="n">phase</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> minutes</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">report</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">""</span><span class="p">)</span>

        <span class="n">report_text</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">report</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
            <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">report_text</span><span class="p">)</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Upgrade report saved to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">report_text</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_examples">6. Integration Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_servicenow_integration">6.1. ServiceNow Integration</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1"># integrations/servicenow.py - ServiceNow ticket automation
</span><span class="k">class</span> <span class="nc">ServiceNowIntegration</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Integrate ISE with ServiceNow for automated workflows</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ise_client</span><span class="p">:</span> <span class="n">ISEClient</span><span class="p">,</span> <span class="n">snow_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ise</span> <span class="o">=</span> <span class="n">ise_client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">snow</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_init_snow_client</span><span class="p">(</span><span class="n">snow_config</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_provision_from_ticket</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">ticket_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Auto-provision network access from ServiceNow request</span><span class="sh">"""</span>
        <span class="c1"># Get ticket details
</span>        <span class="n">ticket</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">snow</span><span class="p">.</span><span class="nf">get_ticket</span><span class="p">(</span><span class="n">ticket_number</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">"</span><span class="s">Network Access Request</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Invalid ticket type</span><span class="sh">"</span><span class="p">}</span>

        <span class="c1"># Extract endpoint information
</span>        <span class="n">mac_address</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">custom_fields</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">mac_address</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">owner_email</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">requested_for</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">department</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">requested_for</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">department</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">access_level</span> <span class="o">=</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">custom_fields</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">access_level</span><span class="sh">"</span><span class="p">]</span>

        <span class="c1"># Determine ISE group based on access level
</span>        <span class="n">group_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">employee</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Employees</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">contractor</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Contractors</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">guest</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Guests</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">iot</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">IoT_Devices</span><span class="sh">"</span>
        <span class="p">}</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">group_mapping</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">access_level</span><span class="p">,</span> <span class="sh">"</span><span class="s">Unknown</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Create endpoint in ISE
</span>        <span class="n">endpoint_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">ERSEndPoint</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">mac_address</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">:</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">upper</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">mac</span><span class="sh">"</span><span class="p">:</span> <span class="n">mac_address</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">groupId</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">ise</span><span class="p">.</span><span class="nf">_get_group_id</span><span class="p">(</span><span class="n">group</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">customAttributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">attributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">Owner</span><span class="sh">"</span><span class="p">:</span> <span class="n">owner_email</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">Department</span><span class="sh">"</span><span class="p">:</span> <span class="n">department</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">ServiceNowTicket</span><span class="sh">"</span><span class="p">:</span> <span class="n">ticket_number</span><span class="p">,</span>
                        <span class="sh">"</span><span class="s">ApprovedBy</span><span class="sh">"</span><span class="p">:</span> <span class="n">ticket</span><span class="p">[</span><span class="sh">"</span><span class="s">approved_by</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">],</span>
                        <span class="sh">"</span><span class="s">ApprovalDate</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ise</span><span class="p">.</span><span class="nf">create_endpoint</span><span class="p">(</span><span class="n">endpoint_data</span><span class="p">)</span>

            <span class="c1"># Update ServiceNow ticket
</span>            <span class="n">self</span><span class="p">.</span><span class="n">snow</span><span class="p">.</span><span class="nf">update_ticket</span><span class="p">(</span><span class="n">ticket_number</span><span class="p">,</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Closed</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">close_notes</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Network access provisioned. ISE Endpoint ID: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">close_code</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Successful</span><span class="sh">"</span>
            <span class="p">})</span>

            <span class="c1"># Send notification
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">_notify_requester</span><span class="p">(</span><span class="n">owner_email</span><span class="p">,</span> <span class="n">mac_address</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">endpoint_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">ticket</span><span class="sh">"</span><span class="p">:</span> <span class="n">ticket_number</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Update ticket with error
</span>            <span class="n">self</span><span class="p">.</span><span class="n">snow</span><span class="p">.</span><span class="nf">update_ticket</span><span class="p">(</span><span class="n">ticket_number</span><span class="p">,</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">state</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Pending</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">work_notes</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Auto-provisioning failed: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
            <span class="p">})</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">success</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">ticket</span><span class="sh">"</span><span class="p">:</span> <span class="n">ticket_number</span>
            <span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_production_deployment">7. Production Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_daily_operations_script">7.1. Daily Operations Script</h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="c1">#!/usr/bin/env python3
# scripts/daily_operations.py - Daily ISE automation tasks
</span>
<span class="kn">import</span> <span class="n">schedule</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="n">ise_automation</span> <span class="kn">import</span> <span class="n">ISEClient</span><span class="p">,</span> <span class="n">EndpointManager</span><span class="p">,</span> <span class="n">PolicyManager</span>

<span class="c1"># Configure logging
</span><span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="sh">'</span><span class="s">%(asctime)s - %(name)s - %(levelname)s - %(message)s</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">logging</span><span class="p">.</span><span class="nc">FileHandler</span><span class="p">(</span><span class="sh">'</span><span class="s">/var/log/ise_automation/daily.log</span><span class="sh">'</span><span class="p">),</span>
        <span class="n">logging</span><span class="p">.</span><span class="nc">StreamHandler</span><span class="p">()</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">DailyOperations</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Automated daily ISE operations</span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Initialize ISE client
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_node_config</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="nc">ISEClient</span><span class="p">(</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">ISE_USERNAME</span><span class="sh">"</span><span class="p">),</span>
            <span class="n">password</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="sh">"</span><span class="s">ISE_PASSWORD</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">endpoint_mgr</span> <span class="o">=</span> <span class="nc">EndpointManager</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">policy_mgr</span> <span class="o">=</span> <span class="nc">PolicyManager</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">morning_health_check</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Morning health check routine</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting morning health check</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check node health
</span>        <span class="n">health_status</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">health_check</span><span class="p">()</span>
        <span class="n">unhealthy</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">health_status</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">]</span> <span class="o">!=</span> <span class="sh">"</span><span class="s">healthy</span><span class="sh">"</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">unhealthy</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_alert_team</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unhealthy nodes detected: </span><span class="si">{</span><span class="n">unhealthy</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check replication status
</span>        <span class="n">replication</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_replication</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">replication</span><span class="p">[</span><span class="sh">"</span><span class="s">in_sync</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_alert_team</span><span class="p">(</span><span class="sh">"</span><span class="s">Replication out of sync</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Check certificate expiration
</span>        <span class="n">certs</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_certificates</span><span class="p">()</span>
        <span class="n">expiring</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">certs</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="sh">"</span><span class="s">days_until_expiry</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">expiring</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_alert_team</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Certificates expiring soon: </span><span class="si">{</span><span class="n">expiring</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Morning health check completed</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_stale_endpoints</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Remove endpoints not seen in 90 days</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting stale endpoint cleanup</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">endpoint_mgr</span><span class="p">.</span><span class="nf">bulk_delete_stale</span><span class="p">(</span><span class="n">days_inactive</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Cleanup results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="sh">"</span><span class="s">deleted</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_send_report</span><span class="p">(</span>
                <span class="sh">"</span><span class="s">Stale Endpoint Cleanup</span><span class="sh">"</span><span class="p">,</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">Deleted </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">deleted</span><span class="sh">'</span><span class="p">])</span><span class="si">}</span><span class="s"> stale endpoints</span><span class="sh">"</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">backup_configuration</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Daily configuration backup</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Starting configuration backup</span><span class="sh">"</span><span class="p">)</span>

        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y%m%d_%H%M%S</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Export policies
</span>        <span class="n">policy_file</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">/backup/ise/policies_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">.yaml</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">policy_mgr</span><span class="p">.</span><span class="nf">export_policies</span><span class="p">(</span><span class="n">policy_file</span><span class="p">)</span>

        <span class="c1"># Export endpoints
</span>        <span class="n">endpoint_file</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">/backup/ise/endpoints_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">.csv</span><span class="sh">"</span>
        <span class="n">self</span><span class="p">.</span><span class="n">endpoint_mgr</span><span class="p">.</span><span class="nf">export_all_endpoints</span><span class="p">(</span><span class="n">endpoint_file</span><span class="p">)</span>

        <span class="c1"># Trigger ISE backup
</span>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">role</span> <span class="o">==</span> <span class="sh">"</span><span class="s">PAN</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">node</span><span class="p">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_trigger_node_backup</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Configuration backup completed</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate_daily_reports</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate and send daily reports</span><span class="sh">"""</span>
        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Generating daily reports</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Authentication summary
</span>        <span class="n">auth_report</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_auth_report</span><span class="p">()</span>

        <span class="c1"># Compliance report
</span>        <span class="n">compliance_report</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">endpoint_mgr</span><span class="p">.</span><span class="nf">generate_compliance_report</span><span class="p">()</span>

        <span class="c1"># Guest usage report
</span>        <span class="n">guest_report</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_guest_report</span><span class="p">()</span>

        <span class="c1"># Send reports
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_send_daily_reports</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">authentication</span><span class="sh">"</span><span class="p">:</span> <span class="n">auth_report</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">compliance</span><span class="sh">"</span><span class="p">:</span> <span class="n">compliance_report</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">guest</span><span class="sh">"</span><span class="p">:</span> <span class="n">guest_report</span>
        <span class="p">})</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Daily reports sent</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run scheduled tasks</span><span class="sh">"""</span>
        <span class="c1"># Schedule tasks
</span>        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">().</span><span class="n">day</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="sh">"</span><span class="s">06:00</span><span class="sh">"</span><span class="p">).</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">morning_health_check</span><span class="p">)</span>
        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">().</span><span class="n">day</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="sh">"</span><span class="s">02:00</span><span class="sh">"</span><span class="p">).</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">cleanup_stale_endpoints</span><span class="p">)</span>
        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">().</span><span class="n">day</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="sh">"</span><span class="s">03:00</span><span class="sh">"</span><span class="p">).</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">backup_configuration</span><span class="p">)</span>
        <span class="n">schedule</span><span class="p">.</span><span class="nf">every</span><span class="p">().</span><span class="n">day</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="sh">"</span><span class="s">07:00</span><span class="sh">"</span><span class="p">).</span><span class="nf">do</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">generate_daily_reports</span><span class="p">)</span>

        <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">Daily operations scheduler started</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">schedule</span><span class="p">.</span><span class="nf">run_pending</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">operations</span> <span class="o">=</span> <span class="nc">DailyOperations</span><span class="p">()</span>
    <span class="n">operations</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance_metrics">8. Performance Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After implementing this framework, our ISE operations have transformed:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Before Automation</th>
<th class="tableblock halign-left valign-top">After Automation</th>
<th class="tableblock halign-left valign-top">Improvement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endpoint Import Time (10,000 MACs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32x faster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy Deployment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24x faster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compliance Report Generation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24x faster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Upgrade Time (12 nodes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4x faster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Daily Operational Tasks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 hours</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 hours (automated)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100% reduction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTTR (Mean Time to Recovery)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">45 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 minutes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9x faster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual Errors per Month</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15-20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90% reduction</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_lessons_learned">9. Lessons Learned</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_works">9.1. What Works</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Bulk Operations</strong>: Always batch API calls—ISE handles bulk operations much better</p>
</li>
<li>
<p><strong>Rate Limiting</strong>: Essential to prevent overwhelming ISE</p>
</li>
<li>
<p><strong>Comprehensive Logging</strong>: Every action must be auditable</p>
</li>
<li>
<p><strong>Gradual Rollout</strong>: Test automation on small subsets first</p>
</li>
<li>
<p><strong>Version Control</strong>: Treat policies as code</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_common_pitfalls">9.2. Common Pitfalls</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Ignoring API Limits</strong>: ISE has undocumented rate limits</p>
</li>
<li>
<p><strong>No Rollback Plan</strong>: Always have a way to undo changes</p>
</li>
<li>
<p><strong>Insufficient Error Handling</strong>: ISE APIs can fail in unexpected ways</p>
</li>
<li>
<p><strong>Not Testing at Scale</strong>: What works for 100 endpoints might fail for 10,000</p>
</li>
<li>
<p><strong>Forgetting Maintenance Windows</strong>: Some operations require downtime</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">10. Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This automation framework has fundamentally changed how we manage ISE. What used to take days now takes minutes. Human errors have nearly disappeared. Most importantly, our team can focus on architecture and improvement rather than repetitive tasks.</p>
</div>
<div class="paragraph">
<p>The framework continues to evolve. We&#8217;re currently adding machine learning for anomaly detection and predictive maintenance. The goal isn&#8217;t to replace engineers but to amplify their capabilities.</p>
</div>
<div class="paragraph">
<p>For those managing ISE at scale: start small, automate incrementally, and always maintain manual override capabilities. The investment in automation pays for itself within months through reduced downtime and operational efficiency.</p>
</div>
<hr>
<div class="paragraph">
<p><em>Next post: "Infrastructure as Code: Managing 500+ Network Devices with Terraform and Ansible" - How we manage our entire network infrastructure as code.</em></p>
</div>
<div class="openblock small">
<div class="content">
<div class="paragraph">
<p><strong>About the Author</strong>: Evan Rosado has automated away most of the tedious parts of ISE management, allowing him to focus on architecture and innovation. His framework manages ISE infrastructure supporting 75,000+ endpoints across multiple data centers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-09-20 18:22:44 -0700
</div>
</div>
<script src="code-copy.js"></script>
</body>
</html>